&lt;!DOCTYPE html&gt; &lt;html lang=&quot;fa&quot;&gt; &lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;فرار از شارژر - نسخه نهایی&lt;/title&gt; &lt;style&gt; body { margin: 0; background: #111; overflow: hidden; font-family: sans-serif;} canvas { display: block; margin: auto; background: #222; } #shop { display: none; text-align: center; color:white; padding:20px;background:#111;} button {margin:10px; padding:10px 20px;} &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;canvas id=&quot;gameCanvas&quot; width=&quot;500&quot; height=&quot;400&quot;&gt;&lt;/canvas&gt; &lt;!-- فروشگاه --&gt; &lt;div id=&quot;shop&quot;&gt; &lt;h2&gt;🛒 فروشگاه ربات‌ها&lt;/h2&gt; &lt;p&gt;سکه‌ات: &lt;span id=&quot;coinsDisplay&quot;&gt;0&lt;/span&gt;&lt;/p&gt; &lt;button onclick=&quot;buyRobot(&#39;green&#39;,200)&quot;&gt;ربات سبز - 200 سکه&lt;/button&gt; &lt;button onclick=&quot;buyRocketUpgrade(300)&quot;&gt;ارتقای موشک +۱ ثانیه (300 سکه)&lt;/button&gt; &lt;h3&gt;🎯 ماموریت‌های روزانه&lt;/h3&gt; &lt;ul id=&quot;missionsList&quot;&gt;&lt;/ul&gt; &lt;h3&gt;🌍 جدول امتیاز جهانی&lt;/h3&gt; &lt;ul id=&quot;leaderboardList&quot;&gt;&lt;/ul&gt; &lt;button onclick=&quot;loadLeaderboard()&quot;&gt;📊 بروزرسانی جدول&lt;/button&gt;&lt;br&gt;&lt;br&gt; &lt;button onclick=&quot;restartGame()&quot;&gt;شروع دوباره&lt;/button&gt; &lt;/div&gt; &lt;script&gt; const canvas = document.getElementById(&quot;gameCanvas&quot;); const ctx = canvas.getContext(&quot;2d&quot;); const shopDiv = document.getElementById(&quot;shop&quot;); const coinsDisplay = document.getElementById(&quot;coinsDisplay&quot;); const lbList = document.getElementById(&quot;leaderboardList&quot;); // بازیکن let player = { x: 100, y: 300, size: 30, vy: 0, onGround:true, color:&quot;aqua&quot;}; const groundY = 330; let coins=[], batteries=[], obstacles=[], powerups=[]; let score=0, battery=100, gameOver=false; let rocketMode=false, rocketTimer=0, shield=false; let baseRocketTime=180; // 3 ثانیه (قابل ارتقا) let totalCoins = parseInt(localStorage.getItem(&quot;totalCoins&quot;)) || 0; player.color = localStorage.getItem(&quot;playerColor&quot;) || &quot;aqua&quot;; baseRocketTime = parseInt(localStorage.getItem(&quot;rocketTime&quot;)) || 180; // ماموریت‌های روزانه let dailyMissions = JSON.parse(localStorage.getItem(&quot;dailyMissions&quot;)) || null; function initDailyMissions(){ let today = new Date().toISOString().slice(0,10); if(!dailyMissions || dailyMissions.date !== today){ dailyMissions = { date: today, missions: [ {text:&quot;۱۰ سکه در یک دور جمع کن&quot;, goal:10, progress:0, reward:50, done:false, type:&quot;coinsRound&quot;}, {text:&quot;۵ بار پرش انجام بده&quot;, goal:5, progress:0, reward:30, done:false, type:&quot;jumps&quot;}, {text:&quot;۲۰ ثانیه زنده بمون&quot;, goal:20, progress:0, reward:40, done:false, type:&quot;time&quot;} ] }; saveDailyMissions(); } } function saveDailyMissions(){ localStorage.setItem(&quot;dailyMissions&quot;, JSON.stringify(dailyMissions)); } function updateMissionsUI(){ let ul=document.getElementById(&quot;missionsList&quot;); ul.innerHTML=&quot;&quot;; dailyMissions.missions.forEach(m=&gt;{ let li=document.createElement(&quot;li&quot;); li.textContent=(m.done?&quot;✅ &quot;:&quot;⏳ &quot;)+m.text+&quot; (&quot;+m.progress+&quot;/&quot;+m.goal+&quot;)&quot;; ul.appendChild(li); }); } // کنترل پرش let jumpCount=0; window.addEventListener(&quot;keydown&quot;, e=&gt;{ if(e.code===&quot;Space&quot; &amp;&amp; player.onGround &amp;&amp; !gameOver &amp;&amp; !rocketMode){ player.vy=-12; player.onGround=false; jumpCount++; let jMission=dailyMissions.missions.find(m=&gt;m.type===&quot;jumps&quot;); if(jMission &amp;&amp; !jMission.done){ jMission.progress=jumpCount; checkMission(jMission); } saveDailyMissions(); } }); let timeAlive=0; function update(){ if(gameOver) return; timeAlive+=1/60; // فیزیک if(!rocketMode){ player.y+=player.vy; player.vy+=0.6; } if(player.y&gt;=groundY){ player.y=groundY; player.vy=0; player.onGround=true; } // حرکت آیتم‌ها coins.forEach(c=&gt;c.x-=4); batteries.forEach(b=&gt;b.x-=4); obstacles.forEach(o=&gt;o.x-=6); powerups.forEach(p=&gt;p.x-=4); battery-=0.05; if(battery&lt;=0) endGame(&quot;باتری خالی شد!&quot;); // سکه coins=coins.filter(c=&gt;{ if(checkCollision(player,c,20)){ score+=10; totalCoins+=10; saveData(); let coinMission=dailyMissions.missions.find(m=&gt;m.type===&quot;coinsRound&quot;); if(coinMission &amp;&amp; !coinMission.done){ coinMission.progress=score/10; checkMission(coinMission); saveDailyMissions(); } return false; } return true; }); // باتری batteries=batteries.filter(b=&gt;{ if(checkCollision(player,b,20)){ battery=Math.min(battery+30,100); return false;} return true; }); // مانع obstacles=obstacles.filter(o=&gt;{ if(checkCollision(player,o,30)){ if(shield){ shield=false; return false;} else if(!rocketMode) endGame(&quot;خوردی به مانع!&quot;); } return true; }); // پاورآپ powerups=powerups.filter(p=&gt;{ if(checkCollision(player,p,25)){ if(p.kind===&quot;rocket&quot;){ rocketMode=true; rocketTimer=baseRocketTime; player.y=200; } if(p.kind===&quot;shield&quot;){ shield=true; } return false; } return true; }); if(rocketMode){ rocketTimer--; if(rocketTimer&lt;=0){ rocketMode=false; player.y=groundY; } } // اسپاون if(Math.random()&lt;0.02) coins.push({x:canvas.width+50,y:280+Math.random()*-80}); if(Math.random()&lt;0.005) batteries.push({x:canvas.width+50,y:280}); if(Math.random()&lt;0.01) obstacles.push({x:canvas.width+50,y:groundY,h:30}); if(Math.random()&lt;0.002) powerups.push({x:canvas.width+50,y:280,kind:&quot;rocket&quot;}); if(Math.random()&lt;0.003) powerups.push({x:canvas.width+50,y:280,kind:&quot;shield&quot;}); // زمان ماموریت let tMission=dailyMissions.missions.find(m=&gt;m.type===&quot;time&quot;); if(tMission &amp;&amp; !tMission.done){ tMission.progress=Math.floor(timeAlive); checkMission(tMission); saveDailyMissions(); } } function draw(){ ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle=rocketMode?&quot;orange&quot;:(shield?&quot;cyan&quot;:player.color); ctx.fillRect(player.x,player.y,player.size,player.size); ctx.fillStyle=&quot;gold&quot;; coins.forEach(c=&gt;{ctx.beginPath();ctx.arc(c.x,c.y,10,0,Math.PI*2);ctx.fill();}); ctx.fillStyle=&quot;lime&quot;; batteries.forEach(b=&gt;ctx.fillRect(b.x,b.y,20,20)); ctx.fillStyle=&quot;red&quot;; obstacles.forEach(o=&gt;ctx.fillRect(o.x,o.y,30,o.h)); powerups.forEach(p=&gt;{ if(p.kind===&quot;rocket&quot;){ctx.fillStyle=&quot;orange&quot;;ctx.fillRect(p.x,p.y,20,20);} else {ctx.fillStyle=&quot;cyan&quot;;ctx.beginPath();ctx.arc(p.x,p.y,12,0,Math.PI*2);ctx.fill();} }); ctx.fillStyle=&quot;#555&quot;; ctx.fillRect(0,groundY+30,canvas.width,50); ctx.fillStyle=&quot;white&quot;; ctx.font=&quot;16px Arial&quot;; ctx.fillText(&quot;امتیاز:&quot;+score,20,20); ctx.fillText(&quot;باتری:&quot;+Math.floor(battery)+&quot;%&quot;,20,40); ctx.fillText(&quot;کل سکه:&quot;+totalCoins,20,60); if(rocketMode) ctx.fillText(&quot;🚀 موشک فعال&quot;,20,80); if(shield) ctx.fillText(&quot;🛡 سپر فعال&quot;,20,100); if(gameOver){ ctx.fillStyle=&quot;yellow&quot;; ctx.font=&quot;24px Arial&quot;; ctx.fillText(&quot;بازی تمام شد!&quot;,170,200); } } function checkCollision(p,obj,size){ return Math.abs(p.x-obj.x)&lt;size &amp;&amp; Math.abs(p.y-obj.y)&lt;size;} function endGame(msg){ gameOver=true; setTimeout(()=&gt;{ alert(msg+&quot; امتیاز:&quot;+score); openShop();},100); } function saveData(){ localStorage.setItem(&quot;totalCoins&quot;,totalCoins); localStorage.setItem(&quot;playerColor&quot;,player.color); localStorage.setItem(&quot;rocketTime&quot;,baseRocketTime);} function buyRobot(color,price){ if(totalCoins&gt;=price){totalCoins-=price; player.color=color; saveData(); alert(&quot;✅ ربات جدید!&quot;); coinsDisplay.innerText=totalCoins;} else alert(&quot;سکه کافی نداری!&quot;); } function buyRocketUpgrade(price){ if(totalCoins&gt;=price){ totalCoins-=price; baseRocketTime+=60; saveData(); alert(&quot;✅ ارتقا!&quot;); coinsDisplay.innerText=totalCoins;} else alert(&quot;سکه کافی نداری!&quot;); } function openShop(){ canvas.style.display=&quot;none&quot;; shopDiv.style.display=&quot;block&quot;; coinsDisplay.innerText=totalCoins; updateMissionsUI(); loadLeaderboard();} function restartGame(){ shopDiv.style.display=&quot;none&quot;; canvas.style.display=&quot;block&quot;; score=0;battery=100;gameOver=false;coins=[];batteries=[];obstacles=[];powerups=[];player.x=100;player.y=300;player.vy=0;player.onGround=true;rocketMode=false;shield=false;jumpCount=0;timeAlive=0; gameLoop();} function gameLoop(){update();draw();if(!gameOver) requestAnimationFrame(gameLoop);} // ماموریت انجام شد؟ function checkMission(mission){ if(mission.progress&gt;=mission.goal &amp;&amp; !mission.done){ mission.done=true; totalCoins+=mission.reward; saveData(); alert(&quot;🎉 ماموریت انجام شد! پاداش &quot;+mission.reward+&quot; سکه&quot;); } } // لیدربورد (نیاز به سرور) function loadLeaderboard(){ lbList.innerHTML=&quot;&lt;li&gt;⚠️ برای واقعی کردن لیدربورد باید API سرور تنظیم شود&lt;/li&gt;&quot;; // برای تست میشه اینجا mock data گذاشت let mock=[{player:&quot;Ali&quot;,score:500},{player:&quot;Sara&quot;,score:350},{player:&quot;You&quot;,score:score}]; mock.forEach(row=&gt;{let li=document.createElement(&quot;li&quot;);li.textContent=row.player+&quot;: &quot;+row.score;lbList.appendChild(li);}); } initDailyMissions(); gameLoop(); &lt;/script&gt; &lt;/body&gt; &lt;/html&gt;